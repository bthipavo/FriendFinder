<!DOCTYPE html>
<html>
<head>
	<title>Friend Finder</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  	<script src="https://code.jquery.com/jquery.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>
<body>
	<div class="container">
		<div class="jumbotron">
			<h1> Friend Survey</h1>
		</div>

		<div class="row">
			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h4 class="panel-title">
							Survey Questions
						</h4>
					</div>

					<div class="panel-body">
						<form role="form">
							<label for="username">Name</label>
							<input type="text" name="username" id="username">
							<label for="picture">Picture Link</label>
							<input type="text" name="picture" id="picture">
							
						</form>
						<!-- <form role="form">
							
						</form> -->
						<form role="form">
							<p> How strongly do you feel about food?</p>
							<div class="form-group">
								<input type="radio" id="food-question1" value="1" name="food"/>
								<label for="food-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="food-question2" value="2" name="food"/>
								<label for="food-question2">2</label>

								<input type="radio" id="food-question3" value="3" name="food"/>
								<label for="food-question3">3</label>

								<input type="radio" id="food-question4" value="4" name="food"/>
								<label for="food-question4">4</label>

								<input type="radio" id="food-question5" value="5" name="food"/>
								<label for="food-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> In terms of politics, how conservative are you?</p>
							<div class="form-group">
								<input type="radio" id="politics-question1" value="1" name="politics"/>
								<label for="politics-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="politics-question2" value="2" name="politics"/>
								<label for="politics-question2">2</label>

								<input type="radio" id="politics-question3" value="3" name="politics"/>
								<label for="politics-question3">3</label>

								<input type="radio" id="politics-question4" value="4" name="politics"/>
								<label for="politics-question4">4</label>

								<input type="radio" id="politics-question5" value="5" name="politics"/>
								<label for="politics-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> Do you want children</p>
							<div class="form-group">
								<input type="radio" id="children-question1" value="1" name="children"/>
								<label for="children-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="children-question2" value="2" name="children"/>
								<label for="children-question2">2</label>

								<input type="radio" id="children-question3" value="3" name="children"/>
								<label for="children-question3">3</label>

								<input type="radio" id="children-question4" value="4" name="children"/>
								<label for="children-question4">4</label>

								<input type="radio" id="children-question5" value="5" name="children"/>
								<label for="children-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> You like dogs more than cats</p>
							<div class="form-group">
								<input type="radio" id="dogs-question1" value="1" name="dogs"/>
								<label for="dogs-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="dogs-question2" value="2" name="dogs"/>
								<label for="dogs-question2">2</label>

								<input type="radio" id="dogs-question3" value="3" name="dogs"/>
								<label for="dogs-question3">3</label>

								<input type="radio" id="dogs-question4" value="4" name="dogs"/>
								<label for="dogs-question4">4</label>

								<input type="radio" id="dogs-question5" value="5" name="dogs"/>
								<label for="dogs-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> You prefer a sports car over a family car</p>
							<div class="form-group">
								<input type="radio" id="car-question1" value="1" name="car"/>
								<label for="car-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="car-question2" value="2" name="car"/>
								<label for="car-question2">2</label>

								<input type="radio" id="car-question3" value="3" name="car"/>
								<label for="car-question3">3</label>

								<input type="radio" id="car-question4" value="4" name="car"/>
								<label for="car-question4">4</label>

								<input type="radio" id="car-question5" value="5" name="car"/>
								<label for="car-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> You like to eat meat</p>
							<div class="form-group">
								<input type="radio" id="meat-question1" value="1" name="meat"/>
								<label for="meat-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="meat-question2" value="2" name="meat"/>
								<label for="meat-question2">2</label>

								<input type="radio" id="meat-question3" value="3" name="meat"/>
								<label for="meat-question3">3</label>

								<input type="radio" id="meat-question4" value="4" name="meat"/>
								<label for="meat-question4">4</label>

								<input type="radio" id="meat-question5" value="5" name="meat"/>
								<label for="meat-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> A perfect day involves you staying home</p>
							<div class="form-group">
								<input type="radio" id="home-question1" value="1" name="home"/>
								<label for="home-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="home-question2" value="2" name="home"/>
								<label for="home-question2">2</label>

								<input type="radio" id="home-question3" value="3" name="home"/>
								<label for="home-question3">3</label>

								<input type="radio" id="home-question4" value="4" name="home"/>
								<label for="home-question4">4</label>

								<input type="radio" id="home-question5" value="5" name="home"/>
								<label for="home-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> You tend to let minor disagreements go</p>
							<div class="form-group">
								<input type="radio" id="minor-question1" value="1" name="minor"/>
								<label for="minor-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="minor-question2" value="2" name="minor"/>
								<label for="minor-question2">2</label>

								<input type="radio" id="minor-question3" value="3" name="minor"/>
								<label for="minor-question3">3</label>

								<input type="radio" id="minor-question4" value="4" name="minor"/>
								<label for="minor-question4">4</label>

								<input type="radio" id="minor-question5" value="5" name="minor"/>
								<label for="minor-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> At a party you like to be the center of attention</p>
							<div class="form-group">
								<input type="radio" id="center-question1" value="1" name="center"/>
								<label for="center-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="center-question2" value="2" name="center"/>
								<label for="center-question2">2</label>

								<input type="radio" id="center-question3" value="3" name="center"/>
								<label for="center-question3">3</label>

								<input type="radio" id="center-question4" value="4" name="center"/>
								<label for="center-question4">4</label>

								<input type="radio" id="center-question5" value="5" name="center"/>
								<label for="center-question5">5 (Strongly Agree)</label>
							</div>
						</form>

						<form role="form">
							<p> You are clean</p>
							<div class="form-group">
								<input type="radio" id="clean-question1" value="1" name="clean"/>
								<label for="clean-question1">1 (Strongly Disagree)</label>

								<input type="radio" id="clean-question2" value="2" name="clean"/>
								<label for="clean-question2">2</label>

								<input type="radio" id="clean-question3" value="3" name="clean"/>
								<label for="clean-question3">3</label>

								<input type="radio" id="clean-question4" value="4" name="clean"/>
								<label for="clean-question4">4</label>

								<input type="radio" id="clean-question5" value="5" name="clean"/>
								<label for="clean-question5">5 (Strongly Agree)</label>
							</div>
						</form>
						<input type="submit" id="submitButton" name="submit">

					</div>
					
				</div>
			</div>

<!-- 			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h4 class="panel-title">
							Matches
						</h4>
					</div>

					<div class="panel-body" id="matches">
					</div>
				</div>
			</div> -->
			<div id="myModal" class="modal fade" role="dialog">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							
						</div>
						<div class="modal-body" id="matches">
								
						</div>
						<div class="modal-footer">
					        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="location.href='/home.html'">Close</button>
					    </div>
					</div>
				</div>
			</div>

		</div>

		
	</div>

</body>
</html>

<script type="text/javascript">
	$("#submitButton").on("click", function(event) {
		event.preventDefault();
		$("#matches").append("")
		// var flag = true;
		var errorArray = [];
		console.log(($('#username').val()));
		console.log(($('#picture').val()));
		$(':radio').each(function() {
			var name = $(this).attr('name');
			if(!$(':radio[name="' + name + '"]:checked').length) {
				errorArray.push("Question about " + name + " not answered");
				// flag = false;
			} 
		})

		if((errorArray.length > 0) || ($('#username').val()=="") || ($('#picture').val()=="")) {
			for(x in errorArray) {
				console.log(errorArray[x])

			}
			alert("please answer all questions");
			errorArray = []
		} else if(($('#picture').val()).match(/\.(jpeg|jpg|gif|png)$/) == null) {
				alert("please enter in real image")
			
		} else {
			var currentURL = window.location.origin;
			var newSurvey = {
					"name": $("input[name='username']").val().trim(),
					"photo": $("input[name='picture']").val().trim(),
					"scores": [$("input[name='food']:checked").val().trim(),
					$("input[name='politics']:checked").val().trim(),
					$("input[name='children']:checked").val().trim(),
					$("input[name='dogs']:checked").val().trim(),
					$("input[name='car']:checked").val().trim(),
					$("input[name='meat']:checked").val().trim(),
					$("input[name='home']:checked").val().trim(),
					$("input[name='minor']:checked").val().trim(),
					$("input[name='center']:checked").val().trim(),
					$("input[name='clean']:checked").val().trim()]
				}
				console.log(newSurvey)
				alert("Thank you for taking the survey!")
				// window.location = "/home"

				$.post("/api/friends", newSurvey)
				// , function(data) {
				// // 	if(data) {
				// // 		console.log("data inserted")
				// // 	} else {
				// // 		console.log("data insert failed")
				// // 	}
				// // })
				$.ajax({ url: currentURL + "/api/friends", method: "GET" })
					.then(function(getMatchData) {
					// Here we are logging the URL so we have access to it for troubleshooting
						var totalDifference = 40;
						var matchMaker = [];
						
						var arrayLength = getMatchData.length-1
						console.log("------------------------------------");
						console.log("URL: " + currentURL + "/api/friends");
						console.log("------------------------------------");
						// Here we then log the NYTData to console, where it will show up as an object.
						console.log(getMatchData);
						console.log("------------------------------------");
						
						if (getMatchData.length<=1) {
							console.log("congrats you are first")
						} else {
						// Loop through and display each of the customers
							for (var i = 0; i < getMatchData.length-1; i++) {
								console.log("loop " + i)
								var currentMatchDifference = 0;
								// console.log(getMatchData[i].scores.length)
								for(var x = 0; x<(getMatchData[i].scores.length-1);x++) {

									currentMatchDifference = currentMatchDifference + Math.abs(getMatchData[i].scores[x]-getMatchData[arrayLength].scores[x])

									// console.log("difference: "+(Math.abs(getMatchData[i].scores[x]-getMatchData[arrayLength].scores[x])) + " match: " + getMatchData[i].scores[x] + " current user: " +getMatchData[arrayLength].scores[x]);

									// console.log("currentMatchDifference " + currentMatchDifference)
								}

								if(currentMatchDifference<=totalDifference) {
									if (currentMatchDifference == totalDifference) {
										console.log("equals")
										matchMaker.push(i)
									} else {
										console.log(currentMatchDifference + " currentMatchDifference")
										console.log(totalDifference + " totalDifference")
										console.log("new value")
										matchMaker = []
										matchMaker.push(i)
									}
									totalDifference = currentMatchDifference
									console.log("match change " + i)
								}


							}
							for (var y = 0; y<matchMaker.length; y++) {
									console.log(matchMaker.length)
									console.log("matches: " + matchMaker[y])
								}
						}//end of if


						for (var y = 0; y<matchMaker.length; y++) {
							console.log("matches: " + matchMaker[y])
							$("#myModal").modal('toggle');
							$("#matches").append("<h2>"+getMatchData[matchMaker[y]].name+"</h2>")
							$("#matches").append('<img src="'+getMatchData[matchMaker[y]].photo+'"alt="future mate" height="42" width="42">')
						}
					});//end of ajax call
						
		}
				
		
	})
</script>